<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naval Inspection Robot</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Naval Inspection Robot</h1>
            <div class="connection-status">
                <span id="ros-status" class="status-indicator disconnected">ROS: Disconnected</span>
                <span id="cam-status" class="status-indicator disconnected">CAM: Disconnected</span>
            </div>
        </header>

        <main>
            <!-- Left Panel: Dual Cameras -->
            <div class="left-panel">
                <div class="panel camera-panel">
                    <h2>Camera Feeds</h2>
                    <div class="dual-camera-container">
                        <!-- Front Camera -->
                        <div class="camera-wrapper">
                            <div class="camera-label">FRONT CAM</div>
                            <div class="camera-box">
                                <img id="cam-left" alt="Front Camera">
                                <div class="fps-counter" id="fps-left">-- FPS</div>
                            </div>
                            <div class="cam-controls-row">
                                <div class="zoom-control">
                                    <label>Zoom: <span id="zoom-left-val">1</span>x</label>
                                    <input type="range" id="zoom-left" min="1" max="5" value="1" step="1">
                                </div>
                                <div class="tilt-control">
                                    <label>Tilt: <span id="tilt-front-val">0</span>&deg;</label>
                                    <input type="range" id="tilt-front" min="0" max="90" value="0" step="5">
                                </div>
                            </div>
                        </div>
                        <!-- Rear Camera -->
                        <div class="camera-wrapper">
                            <div class="camera-label">REAR CAM</div>
                            <div class="camera-box">
                                <img id="cam-right" alt="Rear Camera">
                                <div class="fps-counter" id="fps-right">-- FPS</div>
                            </div>
                            <div class="cam-controls-row">
                                <div class="zoom-control">
                                    <label>Zoom: <span id="zoom-right-val">1</span>x</label>
                                    <input type="range" id="zoom-right" min="1" max="5" value="1" step="1">
                                </div>
                                <div class="tilt-control">
                                    <label>Tilt: <span id="tilt-rear-val">0</span>&deg;</label>
                                    <input type="range" id="tilt-rear" min="0" max="90" value="0" step="5">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Controls -->
            <div class="right-panel">
                <!-- Obstacle Status -->
                <div class="panel obstacle-panel">
                    <h2>Obstacle Avoidance</h2>
                    <div class="obstacle-display">
                        <div class="obstacle-state" id="obstacle-state">No LiDAR</div>
                        <div class="obstacle-distances">
                            <span class="dist-item">L: <span id="dist-left">--</span>m</span>
                            <span class="dist-item">F: <span id="dist-front">--</span>m</span>
                            <span class="dist-item">R: <span id="dist-right">--</span>m</span>
                        </div>
                    </div>
                </div>

                <!-- Movement Controls -->
                <div class="panel movement-panel">
                    <h2>Movement</h2>
                    <div class="dpad-container">
                        <div class="d-pad">
                            <button id="btn-fwd-left" class="btn btn-direction btn-fwd-left" title="Forward-Left">&#8598;</button>
                            <button id="btn-forward" class="btn btn-direction btn-up" title="Forward (W)">&#9650;</button>
                            <button id="btn-fwd-right" class="btn btn-direction btn-fwd-right" title="Forward-Right">&#8599;</button>
                            <button id="btn-rot-left" class="btn btn-direction btn-left" title="Rotate Left (Q)">&#8634;</button>
                            <button id="btn-stop" class="btn btn-direction btn-center" title="Stop (Space)">STOP</button>
                            <button id="btn-rot-right" class="btn btn-direction btn-right" title="Rotate Right (E)">&#8635;</button>
                            <button id="btn-bwd-left" class="btn btn-direction btn-bwd-left" title="Backward-Left">&#8601;</button>
                            <button id="btn-backward" class="btn btn-direction btn-down" title="Backward (S)">&#9660;</button>
                            <button id="btn-bwd-right" class="btn btn-direction btn-bwd-right" title="Backward-Right">&#8600;</button>
                        </div>
                    </div>
                    <div class="strafe-row">
                        <button id="btn-strafe-left" class="btn btn-strafe" title="Strafe Left (A)">&#9664; Strafe L</button>
                        <button id="btn-strafe-toggle" class="btn btn-mode" onclick="toggleStrafeMode()" title="Toggle Strafe/Turn (M)">Mode: Strafe</button>
                        <button id="btn-strafe-right" class="btn btn-strafe" title="Strafe Right (D)">Strafe R &#9654;</button>
                    </div>
                </div>

                <!-- Speed Control -->
                <div class="panel speed-panel">
                    <h2>Speed Level</h2>
                    <div class="speed-buttons">
                        <button id="btn-speed-1" class="btn btn-speed active" title="Speed 1 (key: 1)">1 - Slow</button>
                        <button id="btn-speed-2" class="btn btn-speed" title="Speed 2 (key: 2)">2 - Medium</button>
                        <button id="btn-speed-3" class="btn btn-speed" title="Speed 3 (key: 3)">3 - Fast</button>
                    </div>
                </div>

                <!-- E-STOP -->
                <div class="panel estop-panel">
                    <button id="btn-estop" class="btn btn-danger btn-large" title="Emergency Stop (Esc)">E-STOP</button>
                </div>

                <!-- Status Display -->
                <div class="panel status-panel">
                    <h2>Status</h2>
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-label">Speed:</span>
                            <span id="status-speed" class="status-value">1</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Direction:</span>
                            <span id="status-direction" class="status-value">Stopped</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">E-Stop:</span>
                            <span id="status-estop" class="status-value">OFF</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Arduino:</span>
                            <span id="status-arduino" class="status-value">--</span>
                        </div>
                    </div>
                </div>

                <!-- Keyboard Shortcuts -->
                <div class="panel shortcuts-panel">
                    <h2>Keyboard Shortcuts</h2>
                    <div class="shortcuts-grid">
                        <kbd>W</kbd> Forward
                        <kbd>S</kbd> Backward
                        <kbd>A</kbd> Strafe Left
                        <kbd>D</kbd> Strafe Right
                        <kbd>Q</kbd> Rotate Left
                        <kbd>E</kbd> Rotate Right
                        <kbd>M</kbd> Strafe/Turn
                        <kbd>1-3</kbd> Speed
                        <kbd>Space</kbd> Stop
                        <kbd>Esc</kbd> E-STOP
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>Naval Inspection Robot Control Panel | ROS2 Humble</p>
        </footer>
    </div>

    <!-- Configuration from server -->
    <script>
        window.ROSBRIDGE_PORT = {{ rosbridge_port }};
        window.CAM_SERVER_PORT = {{ cam_server_port }};
        window.CMD_VEL_TOPIC = '{{ cmd_vel_topic }}';
    </script>
    <script src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>
    <script src="/static/js/control.js"></script>
</body>
</html>
